# 整改归档查询功能说明

## 📋 功能概述

整改归档查询功能用于查询和管理已销号归档的整改任务，提供完整的归档记录查询、统计分析和报告下载功能。

## 🎯 业务场景

### 什么是销号归档？

当整改任务完成并通过复查验收后，纪检监察部门会对整改任务进行**销号归档**操作：

1. **销号**：表示问题已整改到位，可以结案
2. **归档**：将整改记录存档，便于后续查询和审计

### 归档的作用

- ✅ 记录整改全过程，留存历史数据
- ✅ 提供整改效果评估依据
- ✅ 支持审计检查和上级督查
- ✅ 为类似问题整改提供参考
- ✅ 统计分析整改工作成效

## 🔄 完整流程

```
问题发现 → 工单核查 → 整改跟踪 → 复查验收 → 销号归档 → 归档查询
```

### 详细步骤

1. **整改完成**：责任单位完成所有整改措施，上传佐证材料
2. **申请复查**：责任单位申请纪检部门复查验收
3. **复查验收**：纪检部门现场复查，确认整改到位
4. **销号归档**：纪检部门点击"销号归档"按钮
5. **归档查询**：在归档查询页面查看归档记录

## 📊 归档数据内容

### 基本信息
- 任务编号
- 整改标题
- 责任单位
- 责任人
- 创建时间
- 归档时间
- 整改周期（天数）

### 整改内容
- 问题描述
- 整改措施
- 量化指标完成情况
- 整改时间轴

### 整改成果
- 制度建立情况
- 人员培训情况
- 系统优化情况
- 流程改进情况

### 佐证材料
- 整改方案文件
- 制度文件
- 培训记录
- 验收报告
- 其他证明材料

## 🖥️ 功能界面

### 1. 归档查询页面

访问路径：`rectification-archive.html`

#### 统计看板
```
┌─────────────────────────────────────────────────────┐
│ 归档总数: 12    本年度归档: 8    本月归档: 3        │
│ 平均整改周期: 45天                                   │
└─────────────────────────────────────────────────────┘
```

#### 搜索筛选
- 关键词搜索：任务编号、标题、责任人
- 归档年份筛选：2025年、2024年、2023年
- 责任单位筛选：财务处、科研处、资产处等
- 来源类型筛选：纪检核查、审计核查等

#### 归档列表
| 任务编号 | 整改任务 | 责任单位 | 责任人 | 创建时间 | 归档时间 | 整改周期 | 操作 |
|---------|---------|---------|--------|---------|---------|---------|------|
| ZG2025002 | 固定资产管理不规范整改 | 资产处 | 李四 | 2025-09-01 | 2025-10-25 | 54天 | 查看/下载 |

### 2. 归档详情模态框

点击"查看详情"按钮后显示：

```
┌─────────────────────────────────────┐
│ 归档详情                              │
├─────────────────────────────────────┤
│ 基本信息                              │
│ - 任务编号: ZG2025002                │
│ - 状态: 已归档                        │
│ - 责任单位: 资产处                    │
│ - 整改周期: 54天                      │
├─────────────────────────────────────┤
│ 整改内容                              │
│ - 问题描述: ...                       │
│ - 整改措施: ...                       │
├─────────────────────────────────────┤
│ 整改成果                              │
│ ✓ 资产清查: 完成全校固定资产清查      │
│ ✓ 制度建立: 制定资产管理办法          │
│ ✓ 人员配备: 配备3名专职管理员         │
│ ✓ 系统上线: 资产管理系统上线          │
├─────────────────────────────────────┤
│ 佐证材料                              │
│ 📄 资产清查报告.pdf (3.5 MB)         │
│ 📄 资产管理制度.docx (245 KB)        │
│ 📄 整改验收报告.pdf (1.8 MB)         │
├─────────────────────────────────────┤
│ [关闭] [下载归档报告]                 │
└─────────────────────────────────────┘
```

## 🔧 技术实现

### 1. 销号归档时记录归档信息

在 `js/rectification.js` 的 `closeTask()` 函数中：

```javascript
function closeTask() {
    if (!currentRectification) return;
    
    if (confirm('确认销号归档吗？此操作不可撤销。')) {
        currentRectification.status = 'completed';
        currentRectification.progress = 100;
        currentRectification.completedAt = new Date().toISOString().split('T')[0];
        currentRectification.archivedAt = new Date().toISOString().split('T')[0];
        
        // 计算整改周期
        if (currentRectification.createdAt) {
            const created = new Date(currentRectification.createdAt);
            const archived = new Date(currentRectification.archivedAt);
            currentRectification.duration = Math.ceil((archived - created) / (1000 * 60 * 60 * 24));
        }
        
        showToast('已销号归档，可在"整改归档查询"中查看', 'success');
        // ...
    }
}
```

### 2. 归档数据结构

```javascript
{
    id: 'ZG2025002',
    title: '固定资产管理不规范整改',
    department: '资产处',
    responsible: '李四',
    status: 'completed',
    progress: 100,
    
    // 时间信息
    createdAt: '2025-09-01',      // 创建时间
    completedAt: '2025-10-25',    // 完成时间
    archivedAt: '2025-10-25',     // 归档时间
    duration: 54,                  // 整改周期（天）
    
    // 来源信息
    source: '工单 WO202509150001',
    sourceType: '审计核查',
    
    // 整改内容
    description: '问题描述...',
    measures: '整改措施...',
    
    // 整改成果
    achievements: [
        { item: '资产清查', result: '完成全校固定资产清查' },
        { item: '制度建立', result: '制定资产管理办法' }
    ],
    
    // 佐证材料
    evidences: [
        { name: '资产清查报告.pdf', size: '3.5 MB', uploadDate: '2025-09-20' }
    ]
}
```

### 3. 归档查询页面

- **HTML**: `rectification-archive.html`
- **JavaScript**: `js/rectification-archive.js`
- **CSS**: 复用 `css/rectification.css`

## 📈 统计分析

### 归档统计指标

1. **归档总数**：所有已归档的整改任务数量
2. **本年度归档**：当年归档的任务数量
3. **本月归档**：当月归档的任务数量
4. **平均整改周期**：所有归档任务的平均整改天数

### 数据分析维度

- 按年份统计归档数量
- 按单位统计整改效率
- 按来源类型统计问题分布
- 按整改周期分析整改难度

## 🔍 查询方式

### 1. 关键词搜索
在搜索框输入：
- 任务编号：ZG2025002
- 任务标题：固定资产
- 责任人：李四

### 2. 条件筛选
- **归档年份**：选择2025年、2024年等
- **责任单位**：选择财务处、科研处等
- **来源类型**：选择纪检核查、审计核查等

### 3. 组合查询
可以同时使用关键词搜索和条件筛选，实现精确查询。

## 📥 导出功能

### 1. 导出归档数据
点击"导出归档数据"按钮，导出当前筛选结果的Excel文件，包含：
- 基本信息
- 整改内容
- 整改周期
- 归档时间

### 2. 下载归档报告
在归档详情页面点击"下载归档报告"，生成PDF格式的完整归档报告，包含：
- 整改任务基本信息
- 问题描述和整改措施
- 整改成果和量化指标
- 佐证材料清单
- 复查验收意见

## 🔐 权限控制

### 查询权限
- **纪检监察人员**：可以查询所有归档记录
- **审计人员**：可以查询所有归档记录
- **责任单位**：只能查询本单位的归档记录
- **领导**：可以查询所有归档记录

### 操作权限
- **下载报告**：所有有查询权限的用户都可以下载
- **导出数据**：仅纪检监察人员和审计人员可以导出

## 📝 使用场景

### 场景1：年度审计检查
审计部门需要查看本年度所有整改任务的完成情况：
1. 打开归档查询页面
2. 选择归档年份：2025年
3. 查看归档列表和统计数据
4. 导出归档数据用于审计报告

### 场景2：上级督查
上级部门来校督查整改工作落实情况：
1. 打开归档查询页面
2. 搜索特定问题的整改记录
3. 查看归档详情和佐证材料
4. 下载归档报告提交上级

### 场景3：整改效果评估
纪检部门评估整改工作成效：
1. 查看平均整改周期
2. 按单位统计整改效率
3. 分析整改成果
4. 总结经验教训

### 场景4：类似问题参考
发现新问题时，查找类似问题的整改经验：
1. 搜索相关关键词
2. 查看历史整改措施
3. 参考整改方案
4. 借鉴成功经验

## 🎨 界面优化建议

### 1. 归档标签
在整改管理页面的整改列表中，为已归档的任务添加标签：
```html
<span class="badge badge-success">
    <i class="fas fa-archive"></i> 已归档
</span>
```

### 2. 快速入口
在整改管理页面添加"查看归档"按钮：
```html
<button class="btn btn-secondary" onclick="window.location.href='rectification-archive.html'">
    <i class="fas fa-archive"></i> 查看归档
</button>
```

### 3. 归档提示
销号归档成功后，显示提示信息：
```
已销号归档，可在"整改归档查询"中查看
[立即查看]
```

## 🔄 数据同步

### 实时同步
- 整改任务销号归档后，立即在归档查询页面可见
- 归档数据与整改数据保持同步
- 修改归档记录时，同步更新统计数据

### 数据备份
- 定期备份归档数据
- 支持数据恢复
- 防止数据丢失

## 📊 报表功能

### 1. 归档统计报表
- 按月度统计归档数量
- 按单位统计整改效率
- 按问题类型统计分布
- 生成可视化图表

### 2. 整改效果评估报表
- 整改周期分析
- 整改成果统计
- 问题复发率分析
- 整改质量评估

## 🚀 后续优化

1. **智能分析**：基于归档数据进行智能分析，发现问题规律
2. **预警功能**：对高频问题进行预警，提前防范
3. **知识库**：将归档记录转化为知识库，供查询参考
4. **移动端**：开发移动端归档查询功能
5. **API接口**：提供归档数据API，支持第三方系统调用

## 📞 技术支持

如有问题，请联系：
- 技术支持：纪检监察室
- 系统管理员：信息中心

---

**文档版本**：v1.0  
**创建时间**：2025-10-28  
**状态**：✅ 已完成
