<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>æ¸…é™¤ETLæ•°æ®</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
        }
        .button {
            padding: 15px 30px;
            font-size: 16px;
            margin: 10px;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            color: white;
        }
        .btn-danger {
            background-color: #ef4444;
        }
        .btn-danger:hover {
            background-color: #dc2626;
        }
        .btn-success {
            background-color: #10b981;
        }
        .btn-success:hover {
            background-color: #059669;
        }
        .info-box {
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
            background-color: #f0f9ff;
            border-left: 4px solid: #3b82f6;
        }
        .result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 5px;
        }
        .success {
            background-color: #d1fae5;
            color: #065f46;
        }
        .error {
            background-color: #fee2e2;
            color: #991b1b;
        }
    </style>
</head>
<body>
    <h1>ğŸ”§ ETLæ•°æ®ç®¡ç†å·¥å…·</h1>
    
    <div class="info-box">
        <h3>è¯´æ˜</h3>
        <p>å¦‚æœETLç®¡ç†é¡µé¢æ²¡æœ‰æ˜¾ç¤ºæ¼”ç¤ºæ•°æ®ï¼Œè¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š</p>
        <ol>
            <li>ç‚¹å‡»"æ¸…é™¤ETLæ•°æ®"æŒ‰é’®</li>
            <li>ç­‰å¾…ç¡®è®¤æ¶ˆæ¯</li>
            <li>ç‚¹å‡»"æ‰“å¼€ETLç®¡ç†é¡µé¢"</li>
            <li>é¡µé¢ä¼šè‡ªåŠ¨åŠ è½½æ¼”ç¤ºæ•°æ®</li>
        </ol>
    </div>

    <div style="text-align: center;">
        <button class="button btn-danger" onclick="clearData()">
            ğŸ—‘ï¸ æ¸…é™¤ETLæ•°æ®
        </button>
        <button class="button btn-success" onclick="openETLPage()">
            ğŸ“‹ æ‰“å¼€ETLç®¡ç†é¡µé¢
        </button>
    </div>

    <div id="result"></div>

    <div class="info-box" style="margin-top: 30px;">
        <h3>å½“å‰æ•°æ®çŠ¶æ€</h3>
        <div id="status">åŠ è½½ä¸­...</div>
    </div>

    <script>
        function clearData() {
            if (!confirm('ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰ETLæ•°æ®å—ï¼Ÿè¿™å°†åˆ é™¤æ‰€æœ‰ä½œä¸šã€æ‰§è¡Œå†å²å’Œç‰ˆæœ¬ä¿¡æ¯ã€‚')) {
                return;
            }

            try {
                localStorage.removeItem('etl_jobs');
                localStorage.removeItem('etl_executions');
                localStorage.removeItem('etl_versions');
                
                showResult('success', 'âœ“ ETLæ•°æ®å·²æ¸…é™¤ï¼ç°åœ¨å¯ä»¥æ‰“å¼€ETLç®¡ç†é¡µé¢ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨åˆ›å»ºæ¼”ç¤ºæ•°æ®ã€‚');
                updateStatus();
            } catch (error) {
                showResult('error', 'âœ— æ¸…é™¤å¤±è´¥: ' + error.message);
            }
        }

        function openETLPage() {
            window.open('etl-management.html', '_blank');
        }

        function showResult(type, message) {
            const resultDiv = document.getElementById('result');
            resultDiv.className = 'result ' + type;
            resultDiv.innerHTML = message;
        }

        function updateStatus() {
            const statusDiv = document.getElementById('status');
            
            const jobsData = localStorage.getItem('etl_jobs');
            const executionsData = localStorage.getItem('etl_executions');
            const versionsData = localStorage.getItem('etl_versions');
            
            let html = '<table style="width: 100%; border-collapse: collapse;">';
            html += '<tr style="border-bottom: 1px solid #ddd;"><td style="padding: 8px;"><strong>etl_jobs</strong></td><td style="padding: 8px;">';
            
            if (jobsData) {
                try {
                    const jobs = JSON.parse(jobsData);
                    html += `${jobs.length} ä¸ªä½œä¸š`;
                } catch (e) {
                    html += 'æ•°æ®æŸå';
                }
            } else {
                html += '<span style="color: #999;">æœªåˆå§‹åŒ–</span>';
            }
            
            html += '</td></tr>';
            html += '<tr style="border-bottom: 1px solid #ddd;"><td style="padding: 8px;"><strong>etl_executions</strong></td><td style="padding: 8px;">';
            
            if (executionsData) {
                try {
                    const executions = JSON.parse(executionsData);
                    html += `${executions.length} æ¡æ‰§è¡Œè®°å½•`;
                } catch (e) {
                    html += 'æ•°æ®æŸå';
                }
            } else {
                html += '<span style="color: #999;">æœªåˆå§‹åŒ–</span>';
            }
            
            html += '</td></tr>';
            html += '<tr><td style="padding: 8px;"><strong>etl_versions</strong></td><td style="padding: 8px;">';
            
            if (versionsData) {
                try {
                    const versions = JSON.parse(versionsData);
                    html += `${versions.length} ä¸ªç‰ˆæœ¬`;
                } catch (e) {
                    html += 'æ•°æ®æŸå';
                }
            } else {
                html += '<span style="color: #999;">æœªåˆå§‹åŒ–</span>';
            }
            
            html += '</td></tr></table>';
            
            statusDiv.innerHTML = html;
        }

        // é¡µé¢åŠ è½½æ—¶æ›´æ–°çŠ¶æ€
        window.addEventListener('DOMContentLoaded', updateStatus);
        
        // æ¯2ç§’æ›´æ–°ä¸€æ¬¡çŠ¶æ€
        setInterval(updateStatus, 2000);
    </script>
</body>
</html>
