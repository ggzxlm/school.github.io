# 外部数据接入 - 详情和编辑功能说明

## 功能概述

已实现外部数据接入的详情查看和编辑功能，用户可以查看接入的完整配置信息，并对现有接入进行修改。

## 详情查看功能

### 功能入口

在接入列表中，点击每条记录的 **"查看"** 按钮（眼睛图标）

### 显示内容

详情页面分为以下几个部分：

#### 1. 基本信息
- 接入ID
- 接入名称
- 接入类型（带颜色标签）
- 数据源名称
- 当前状态（带颜色标签）
- 同步频率
- 描述信息

#### 2. 配置信息

根据接入类型显示不同的配置：

**API接入配置**：
- API地址（代码样式显示）
- 请求方法（GET/POST/PUT）
- 认证方式
- 认证凭证（隐藏显示为 ********）

**文件接入配置**：
- 文件类型
- 编码格式
- 文件路径（代码样式显示）

**系统接入配置**：
- 系统类型
- 连接地址（代码样式显示）
- 用户名
- 密码（隐藏显示为 ********）

#### 3. 同步信息
- 最后同步时间
- 下次同步时间
- 同步次数
- 错误次数（如果有错误会以红色显示）
- 目标表名

#### 4. 时间信息
- 创建时间
- 更新时间（如果有）

### 界面特点

✅ **清晰的分区布局**：信息按类别分组显示  
✅ **响应式设计**：自动适配不同屏幕尺寸  
✅ **安全显示**：敏感信息（密码、凭证）隐藏显示  
✅ **代码样式**：URL和路径使用等宽字体显示  
✅ **状态标签**：使用彩色标签显示类型和状态  

## 编辑功能

### 功能入口

在接入列表中，点击每条记录的 **"编辑"** 按钮（铅笔图标）

### 可编辑内容

#### 基本信息
- ✅ 接入名称
- ✅ 接入类型
- ✅ 数据源名称
- ✅ 描述信息
- ❌ 接入ID（不可编辑，灰色显示）

#### 配置信息

根据接入类型可编辑对应配置：

**API接入**：
- API地址
- 请求方法
- 认证方式
- 认证凭证（留空保持原值）

**文件接入**：
- 文件类型
- 文件路径
- 编码格式

**系统接入**：
- 系统类型
- 连接地址
- 用户名
- 密码（留空保持原值）

#### 同步配置
- 同步频率
- 目标表名

### 编辑特性

✅ **智能表单**：根据接入类型动态显示对应配置区域  
✅ **数据预填充**：自动填充现有配置数据  
✅ **必填验证**：必填项标记红色星号  
✅ **安全更新**：密码/凭证留空则保持原值不变  
✅ **实时保存**：点击保存后立即更新并刷新列表  

### 操作流程

1. **打开编辑表单**
   - 点击"编辑"按钮
   - 表单自动填充现有数据

2. **修改配置**
   - 修改需要更改的字段
   - 切换接入类型会显示对应配置区域
   - 敏感信息可留空保持不变

3. **保存更改**
   - 点击"保存"按钮
   - 系统验证必填项
   - 保存成功后显示提示
   - 自动刷新列表和统计

4. **取消编辑**
   - 点击"取消"按钮
   - 不保存任何更改

## 使用示例

### 示例1：查看API接入详情

```
操作步骤：
1. 在列表中找到"教育部学籍数据接入"
2. 点击"查看"按钮
3. 查看完整配置信息

显示内容：
- 基本信息：名称、类型、状态等
- API配置：URL、方法、认证方式
- 同步信息：最后同步时间、同步次数
- 时间信息：创建和更新时间
```

### 示例2：编辑同步频率

```
操作步骤：
1. 点击"编辑"按钮
2. 找到"同步频率"下拉框
3. 从"每日"改为"每小时"
4. 点击"保存"

结果：
- 同步频率更新为"每小时"
- 下次同步时间自动重新计算
- 列表中显示更新后的信息
```

### 示例3：更新API认证凭证

```
操作步骤：
1. 点击"编辑"按钮
2. 找到"认证凭证"输入框
3. 输入新的Token
4. 点击"保存"

注意：
- 如果留空，则保持原有凭证不变
- 新凭证会覆盖旧凭证
- 保存后立即生效
```

### 示例4：修改接入类型

```
操作步骤：
1. 点击"编辑"按钮
2. 修改"接入类型"下拉框
3. 从"API接入"改为"文件接入"
4. 填写文件相关配置
5. 点击"保存"

注意：
- 切换类型会显示对应的配置区域
- 原有配置会被新配置替换
- 建议谨慎修改接入类型
```

## 界面截图说明

### 详情页面布局

```
┌─────────────────────────────────────┐
│  📋 接入详情                         │
├─────────────────────────────────────┤
│  基本信息                            │
│  ┌─────────┬─────────┐              │
│  │ 接入ID  │ 名称    │              │
│  │ 类型    │ 数据源  │              │
│  │ 状态    │ 频率    │              │
│  └─────────┴─────────┘              │
│                                      │
│  配置信息                            │
│  ┌─────────────────────┐            │
│  │ API地址             │            │
│  │ 请求方法 │ 认证方式 │            │
│  └─────────────────────┘            │
│                                      │
│  同步信息                            │
│  ┌─────────┬─────────┐              │
│  │ 最后同步│ 下次同步│              │
│  │ 同步次数│ 错误次数│              │
│  └─────────┴─────────┘              │
│                                      │
│  时间信息                            │
│  ┌─────────┬─────────┐              │
│  │ 创建时间│ 更新时间│              │
│  └─────────┴─────────┘              │
│                                      │
│              [关闭]                  │
└─────────────────────────────────────┘
```

### 编辑表单布局

```
┌─────────────────────────────────────┐
│  ✏️ 编辑数据接入                     │
├─────────────────────────────────────┤
│  基本信息                            │
│  ┌─────────────────────┐            │
│  │ 接入ID (不可编辑)   │            │
│  │ 接入名称 *          │            │
│  │ 接入类型 *          │            │
│  │ 数据源名称 *        │            │
│  │ 描述                │            │
│  └─────────────────────┘            │
│                                      │
│  API配置 (根据类型显示)              │
│  ┌─────────────────────┐            │
│  │ API地址 *           │            │
│  │ 请求方法            │            │
│  │ 认证方式            │            │
│  │ 认证凭证            │            │
│  └─────────────────────┘            │
│                                      │
│  同步配置                            │
│  ┌─────────────────────┐            │
│  │ 同步频率 *          │            │
│  │ 目标表              │            │
│  └─────────────────────┘            │
│                                      │
│         [取消]    [保存]             │
└─────────────────────────────────────┘
```

## 技术实现

### 详情功能
- 使用 `getConnectionById()` 获取接入数据
- 动态生成HTML展示详情
- 根据接入类型显示对应配置
- 敏感信息使用 `********` 隐藏

### 编辑功能
- 表单预填充现有数据
- 动态显示/隐藏配置区域
- 表单验证（必填项检查）
- 调用 `updateConnection()` 保存更改

### 数据持久化
- 更新后自动保存到 localStorage
- 刷新列表和统计信息
- 显示操作成功提示

## 注意事项

1. **敏感信息安全**
   - 密码和凭证在详情中隐藏显示
   - 编辑时留空则保持原值

2. **必填项验证**
   - 标记为 * 的字段必须填写
   - 提交前会进行验证

3. **类型切换**
   - 修改接入类型会改变配置区域
   - 原有配置会被替换

4. **实时更新**
   - 保存后立即刷新列表
   - 统计数据同步更新

## 后续优化

计划中的功能：
- [ ] 编辑历史记录
- [ ] 配置对比功能
- [ ] 批量编辑
- [ ] 配置模板
- [ ] 字段级权限控制

---

**版本**: 1.0.0  
**更新时间**: 2024-10-25  
**状态**: ✅ 已完成
