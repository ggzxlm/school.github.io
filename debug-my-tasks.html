<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¾…åŠåŠŸèƒ½è°ƒè¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .debug-panel {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .debug-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #333;
        }
        .status-item {
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .status-ok {
            background: #d1fae5;
            color: #065f46;
        }
        .status-error {
            background: #fee2e2;
            color: #991b1b;
        }
        .status-warning {
            background: #fef3c7;
            color: #92400e;
        }
        .icon {
            font-size: 20px;
        }
        pre {
            background: #f3f4f6;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 12px;
        }
        button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
        }
        button:hover {
            background: #2563eb;
        }
    </style>
</head>
<body>
    <h1>ğŸ” å¾…åŠåŠŸèƒ½è°ƒè¯•å·¥å…·</h1>
    
    <div class="debug-panel">
        <div class="debug-title">ğŸ“‹ æ–‡ä»¶åŠ è½½çŠ¶æ€</div>
        <div id="fileStatus"></div>
    </div>
    
    <div class="debug-panel">
        <div class="debug-title">ğŸ“Š æ•°æ®ç»“æ„æ£€æŸ¥</div>
        <div id="dataStatus"></div>
    </div>
    
    <div class="debug-panel">
        <div class="debug-title">ğŸ¯ åŠŸèƒ½æµ‹è¯•</div>
        <button onclick="testFunction('showTaskDetail')">æµ‹è¯• showTaskDetail å‡½æ•°</button>
        <button onclick="testFunction('viewSourceDetail')">æµ‹è¯• viewSourceDetail å‡½æ•°</button>
        <button onclick="testData()">æŸ¥çœ‹å®Œæ•´æ•°æ®</button>
        <button onclick="clearCache()">æ¸…é™¤ç¼“å­˜æç¤º</button>
    </div>
    
    <div class="debug-panel">
        <div class="debug-title">ğŸ“ è¯¦ç»†ä¿¡æ¯</div>
        <div id="detailInfo"></div>
    </div>

    <script>
        // æ£€æŸ¥æ–‡ä»¶åŠ è½½
        function checkFileStatus() {
            const status = document.getElementById('fileStatus');
            let html = '';
            
            // æ£€æŸ¥mockTasksæ˜¯å¦å­˜åœ¨
            if (typeof mockTasks !== 'undefined') {
                html += '<div class="status-item status-ok"><span class="icon">âœ“</span> mockTasks æ•°æ®å·²åŠ è½½</div>';
            } else {
                html += '<div class="status-item status-error"><span class="icon">âœ—</span> mockTasks æ•°æ®æœªåŠ è½½</div>';
            }
            
            // æ£€æŸ¥å‡½æ•°æ˜¯å¦å­˜åœ¨
            if (typeof showTaskDetail === 'function') {
                html += '<div class="status-item status-ok"><span class="icon">âœ“</span> showTaskDetail å‡½æ•°å·²å®šä¹‰</div>';
            } else {
                html += '<div class="status-item status-error"><span class="icon">âœ—</span> showTaskDetail å‡½æ•°æœªå®šä¹‰</div>';
            }
            
            if (typeof viewSourceDetail === 'function') {
                html += '<div class="status-item status-ok"><span class="icon">âœ“</span> viewSourceDetail å‡½æ•°å·²å®šä¹‰</div>';
            } else {
                html += '<div class="status-item status-error"><span class="icon">âœ—</span> viewSourceDetail å‡½æ•°æœªå®šä¹‰</div>';
            }
            
            // æ£€æŸ¥Modalç»„ä»¶
            if (typeof Modal !== 'undefined') {
                html += '<div class="status-item status-ok"><span class="icon">âœ“</span> Modal ç»„ä»¶å·²åŠ è½½</div>';
            } else {
                html += '<div class="status-item status-error"><span class="icon">âœ—</span> Modal ç»„ä»¶æœªåŠ è½½</div>';
            }
            
            status.innerHTML = html;
        }
        
        // æ£€æŸ¥æ•°æ®ç»“æ„
        function checkDataStatus() {
            const status = document.getElementById('dataStatus');
            let html = '';
            
            if (typeof mockTasks === 'undefined') {
                html = '<div class="status-item status-error"><span class="icon">âœ—</span> æ— æ³•æ£€æŸ¥æ•°æ®ï¼šmockTasks æœªå®šä¹‰</div>';
                status.innerHTML = html;
                return;
            }
            
            html += `<div class="status-item status-ok"><span class="icon">âœ“</span> å…±æœ‰ ${mockTasks.length} ä¸ªå¾…åŠä»»åŠ¡</div>`;
            
            mockTasks.forEach((task, index) => {
                const checks = {
                    source: task.source ? 'âœ“' : 'âœ—',
                    details: task.details ? 'âœ“' : 'âœ—',
                    evidence: task.details?.evidence?.length || 0,
                    attachments: task.details?.attachments?.length || 0,
                    actions: task.process?.requiredActions?.length || 0,
                    history: task.history?.length || 0
                };
                
                const hasAllData = task.source && task.details && task.history;
                const statusClass = hasAllData ? 'status-ok' : 'status-warning';
                
                html += `
                    <div class="status-item ${statusClass}">
                        <span class="icon">${hasAllData ? 'âœ“' : 'âš '}</span>
                        <div>
                            <strong>ä»»åŠ¡${task.id}:</strong> ${task.title}<br>
                            <small>
                                æ¥æº:${checks.source} | 
                                è¯¦æƒ…:${checks.details} | 
                                è¯æ®:${checks.evidence}é¡¹ | 
                                é™„ä»¶:${checks.attachments}ä¸ª | 
                                æ“ä½œ:${checks.actions}é¡¹ | 
                                è®°å½•:${checks.history}æ¡
                            </small>
                        </div>
                    </div>
                `;
            });
            
            status.innerHTML = html;
        }
        
        // æµ‹è¯•å‡½æ•°
        function testFunction(funcName) {
            const detail = document.getElementById('detailInfo');
            
            if (funcName === 'showTaskDetail') {
                if (typeof showTaskDetail === 'function' && typeof mockTasks !== 'undefined') {
                    detail.innerHTML = '<div class="status-item status-ok">æ­£åœ¨è°ƒç”¨ showTaskDetail(1)...</div>';
                    try {
                        showTaskDetail(1);
                        detail.innerHTML += '<div class="status-item status-ok">å‡½æ•°è°ƒç”¨æˆåŠŸï¼è¯·æ£€æŸ¥æ˜¯å¦å¼¹å‡ºæ¨¡æ€æ¡†ã€‚</div>';
                    } catch (e) {
                        detail.innerHTML += `<div class="status-item status-error">å‡½æ•°è°ƒç”¨å¤±è´¥ï¼š${e.message}</div>`;
                    }
                } else {
                    detail.innerHTML = '<div class="status-item status-error">å‡½æ•°æˆ–æ•°æ®æœªåŠ è½½</div>';
                }
            } else if (funcName === 'viewSourceDetail') {
                if (typeof viewSourceDetail === 'function') {
                    detail.innerHTML = '<div class="status-item status-ok">æ­£åœ¨è°ƒç”¨ viewSourceDetail("alert", "ALERT2025001")...</div>';
                    try {
                        viewSourceDetail('alert', 'ALERT2025001');
                        detail.innerHTML += '<div class="status-item status-ok">å‡½æ•°è°ƒç”¨æˆåŠŸï¼</div>';
                    } catch (e) {
                        detail.innerHTML += `<div class="status-item status-error">å‡½æ•°è°ƒç”¨å¤±è´¥ï¼š${e.message}</div>`;
                    }
                } else {
                    detail.innerHTML = '<div class="status-item status-error">å‡½æ•°æœªåŠ è½½</div>';
                }
            }
        }
        
        // æŸ¥çœ‹æ•°æ®
        function testData() {
            const detail = document.getElementById('detailInfo');
            if (typeof mockTasks !== 'undefined' && mockTasks.length > 0) {
                detail.innerHTML = `
                    <h4>ç¬¬ä¸€ä¸ªä»»åŠ¡çš„å®Œæ•´æ•°æ®ï¼š</h4>
                    <pre>${JSON.stringify(mockTasks[0], null, 2)}</pre>
                `;
            } else {
                detail.innerHTML = '<div class="status-item status-error">æ•°æ®æœªåŠ è½½</div>';
            }
        }
        
        // æ¸…é™¤ç¼“å­˜æç¤º
        function clearCache() {
            const detail = document.getElementById('detailInfo');
            detail.innerHTML = `
                <div class="status-item status-warning">
                    <span class="icon">âš </span>
                    <div>
                        <strong>å¦‚æœåŠŸèƒ½ä¸æ­£å¸¸ï¼Œè¯·å°è¯•ä»¥ä¸‹æ–¹æ³•ï¼š</strong><br><br>
                        <strong>1. å¼ºåˆ¶åˆ·æ–°ï¼ˆæ¨èï¼‰</strong><br>
                        Windows/Linux: Ctrl + Shift + R æˆ– Ctrl + F5<br>
                        Mac: Cmd + Shift + R<br><br>
                        <strong>2. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜</strong><br>
                        Chrome: Ctrl + Shift + Delete<br>
                        é€‰æ‹©"ç¼“å­˜çš„å›¾ç‰‡å’Œæ–‡ä»¶"å¹¶æ¸…é™¤<br><br>
                        <strong>3. ä½¿ç”¨æ— ç—•æ¨¡å¼</strong><br>
                        Chrome: Ctrl + Shift + N<br>
                        Firefox: Ctrl + Shift + P<br><br>
                        <strong>4. ç¦ç”¨ç¼“å­˜ï¼ˆå¼€å‘è€…æ¨¡å¼ï¼‰</strong><br>
                        æŒ‰F12æ‰“å¼€å¼€å‘è€…å·¥å…·<br>
                        åœ¨Networkæ ‡ç­¾ä¸­å‹¾é€‰"Disable cache"
                    </div>
                </div>
            `;
        }
        
        // é¡µé¢åŠ è½½æ—¶æ‰§è¡Œæ£€æŸ¥
        window.addEventListener('DOMContentLoaded', () => {
            // å»¶è¿Ÿæ£€æŸ¥ï¼Œç¡®ä¿æ‰€æœ‰è„šæœ¬éƒ½å·²åŠ è½½
            setTimeout(() => {
                checkFileStatus();
                checkDataStatus();
            }, 100);
        });
    </script>
    
    <!-- åŠ è½½å¿…è¦çš„æ–‡ä»¶ -->
    <script src="js/components.js"></script>
    <script src="js/my-tasks.js?v=2.0&t=<?php echo time(); ?>"></script>
</body>
</html>
