# 业务流程集成说明

## 🔄 完整的监督闭环

```
预警/线索 → 工单核查 → 整改跟踪 → 复查销号
```

## 📊 数据关联关系

### 1. 线索库 (Clue Library)
**文件**: `clue-library.html`, `js/clue-library.js`

**数据结构**:
```javascript
{
    id: 'CLUE2025001',                    // 线索编号
    title: '科研经费报销存在连号发票异常',
    type: '系统预警',                      // 线索类型
    risk: 'high',                         // 风险等级
    unit: '计算机学院',                    // 涉及单位
    description: '...',                   // 线索描述
    source: '监督模型自动预警',            // 线索来源
    createdAt: '2025-09-28',              // 登记时间
    status: 'completed',                  // 状态
    
    // 关联工单
    workOrderId: 'WO202510210001',        // 工单编号
    workOrderTitle: '科研经费异常报销核查',
    workOrderStatus: '已完成',
    
    // 关联整改
    rectificationId: 'ZG2025001',         // 整改编号
    rectificationTitle: '科研经费报销不规范问题整改',
    rectificationProgress: 75
}
```

### 2. 工单管理 (Work Order)
**文件**: `work-order.html`, `js/work-order.js`

**需要添加的字段**:
```javascript
{
    id: 'WO202510210001',
    orderNo: 'WO202510210001',
    title: '科研经费异常报销核查',
    
    // 新增：关联线索
    clueId: 'CLUE2025001',                // 线索编号
    clueTitle: '科研经费报销存在连号发票异常',
    clueType: '系统预警',
    
    // 新增：关联整改
    rectificationId: 'ZG2025001',         // 整改编号
    rectificationTitle: '科研经费报销不规范问题整改',
    rectificationProgress: 75,
    
    // 原有字段...
    type: '纪检核查',
    priority: '高',
    status: '已完成',
    // ...
}
```

### 3. 整改管理 (Rectification)
**文件**: `rectification.html`, `js/rectification.js`

**已有的关联字段**:
```javascript
{
    id: 'ZG2025001',
    title: '科研经费报销不规范问题整改',
    
    // 已有：关联工单
    source: '工单 WO202510210001',
    sourceType: '纪检核查',
    
    // 需要补充：关联线索
    clueId: 'CLUE2025001',                // 线索编号
    clueTitle: '科研经费报销存在连号发票异常',
    clueType: '系统预警',
    
    // 需要补充：工单详细信息
    workOrderId: 'WO202510210001',
    workOrderTitle: '科研经费异常报销核查',
    workOrderStatus: '已完成',
    workOrderConclusion: '发现连号发票和异常支出',
    
    // 原有字段...
    department: '科研处',
    responsible: '张三',
    progress: 75,
    status: 'in_progress',
    // ...
}
```

## 🎯 业务流程示例

### 案例1: 科研经费问题完整流程

#### 第1步：线索发现
```
线索编号: CLUE2025001
线索标题: 科研经费报销存在连号发票异常
线索类型: 系统预警
风险等级: 高风险
涉及单位: 计算机学院
线索描述: 监督模型发现某教授科研经费报销存在5张连号发票
登记时间: 2025-09-28
状态: 已完成
```

**操作**: 点击"创建工单"按钮

#### 第2步：工单核查
```
工单编号: WO202510210001
工单标题: 科研经费异常报销核查
关联线索: CLUE2025001
工单类型: 纪检核查
优先级: 高
核查组长: 张三
核查任务:
  - 调取报销凭证 (已完成)
  - 核实发票真伪 (已完成)
  - 约谈当事人 (已完成)
核查结论: 发现连号发票和异常支出，需要整改
状态: 已完成
```

**操作**: 工单完成后，点击"创建整改任务"按钮

#### 第3步：整改跟踪
```
整改编号: ZG2025001
整改标题: 科研经费报销不规范问题整改
关联线索: CLUE2025001
关联工单: WO202510210001
责任单位: 科研处
责任人: 张三
整改措施:
  1. 修订科研经费管理办法
  2. 加强财务人员培训
  3. 完善审批流程
  4. 建立定期检查机制
整改进度: 75%
状态: 整改中
```

**操作**: 整改完成后，点击"复查销号"按钮

#### 第4步：复查销号
```
复查时间: 2025-11-30
复查结论: 整改措施落实到位，通过复查
处理结果: 销号归档
```

## 🔗 页面跳转关系

### 线索库 → 工单管理
```javascript
// 在线索详情页面
<button onclick="createWorkOrderFromClue()">创建工单</button>

// 跳转逻辑
function createWorkOrderFromClue() {
    window.location.href = `work-order.html?action=create&clueId=${currentClue.id}`;
}
```

### 线索库 → 查看关联工单
```javascript
// 在线索详情页面（如果已有工单）
<button onclick="viewWorkOrder()">查看工单详情</button>

// 跳转逻辑
function viewWorkOrder() {
    window.location.href = `work-order.html?id=${currentClue.workOrderId}`;
}
```

### 线索库 → 查看关联整改
```javascript
// 在线索详情页面（如果已有整改）
<button onclick="viewRectification()">查看整改详情</button>

// 跳转逻辑
function viewRectification() {
    window.location.href = `rectification.html?id=${currentClue.rectificationId}`;
}
```

### 工单管理 → 查看来源线索
```javascript
// 在工单详情页面
<button onclick="viewSourceClue()">查看来源线索</button>

// 跳转逻辑
function viewSourceClue() {
    window.location.href = `clue-library.html?id=${currentOrder.clueId}`;
}
```

### 工单管理 → 创建整改任务
```javascript
// 在工单详情页面（工单完成后）
<button onclick="createRectification()">创建整改任务</button>

// 跳转逻辑
function createRectification() {
    window.location.href = `rectification.html?action=create&workOrderId=${currentOrder.id}`;
}
```

### 整改管理 → 查看来源工单
```javascript
// 在整改详情页面
<button onclick="viewSourceWorkOrder()">查看来源工单</button>

// 跳转逻辑
function viewSourceWorkOrder() {
    window.location.href = `work-order.html?id=${currentRectification.workOrderId}`;
}
```

### 整改管理 → 查看原始线索
```javascript
// 在整改详情页面
<button onclick="viewSourceClue()">查看原始线索</button>

// 跳转逻辑
function viewSourceClue() {
    window.location.href = `clue-library.html?id=${currentRectification.clueId}`;
}
```

## 📋 详情页面展示

### 线索详情页面
```
┌─────────────────────────────────────┐
│ 线索详情                              │
├─────────────────────────────────────┤
│ 基本信息                              │
│ - 线索编号: CLUE2025001              │
│ - 线索类型: 系统预警                  │
│ - 风险等级: 高风险                    │
│ - 涉及单位: 计算机学院                │
│ - 线索描述: ...                       │
├─────────────────────────────────────┤
│ 处置信息 (如果已创建工单)             │
│ ┌─────────────────────────────────┐ │
│ │ 📋 关联工单                      │ │
│ │ WO202510210001                  │ │
│ │ 科研经费异常报销核查             │ │
│ │ 状态: 已完成                     │ │
│ │ [查看工单详情]                   │ │
│ └─────────────────────────────────┘ │
├─────────────────────────────────────┤
│ 整改信息 (如果已创建整改)             │
│ ┌─────────────────────────────────┐ │
│ │ ✅ 关联整改                      │ │
│ │ ZG2025001                       │ │
│ │ 科研经费报销不规范问题整改       │ │
│ │ 进度: 75%                        │ │
│ │ [查看整改详情]                   │ │
│ └─────────────────────────────────┘ │
└─────────────────────────────────────┘
```

### 工单详情页面
```
┌─────────────────────────────────────┐
│ 工单详情                              │
├─────────────────────────────────────┤
│ 基本信息                              │
│ - 工单编号: WO202510210001           │
│ - 工单标题: 科研经费异常报销核查      │
│ - 工单类型: 纪检核查                  │
├─────────────────────────────────────┤
│ 来源追溯                              │
│ ┌─────────────────────────────────┐ │
│ │ 💡 来源线索                      │ │
│ │ CLUE2025001                     │ │
│ │ 科研经费报销存在连号发票异常     │ │
│ │ 类型: 系统预警                   │ │
│ │ [查看线索详情]                   │ │
│ └─────────────────────────────────┘ │
├─────────────────────────────────────┤
│ 核查组成员                            │
│ 任务分解                              │
│ 讨论记录                              │
├─────────────────────────────────────┤
│ 后续整改 (如果已创建整改)             │
│ ┌─────────────────────────────────┐ │
│ │ ✅ 关联整改                      │ │
│ │ ZG2025001                       │ │
│ │ 科研经费报销不规范问题整改       │ │
│ │ 进度: 75%                        │ │
│ │ [查看整改详情]                   │ │
│ └─────────────────────────────────┘ │
└─────────────────────────────────────┘
```

### 整改详情页面
```
┌─────────────────────────────────────┐
│ 整改详情                              │
├─────────────────────────────────────┤
│ 基本信息                              │
│ - 整改编号: ZG2025001                │
│ - 责任单位: 科研处                    │
│ - 整改进度: 75%                       │
├─────────────────────────────────────┤
│ 来源追溯 ⭐                           │
│ ┌─────────────────────────────────┐ │
│ │ 📋 关联工单                      │ │
│ │ WO202510210001                  │ │
│ │ 科研经费异常报销核查             │ │
│ │ 状态: 已完成                     │ │
│ │ 核查结论: 发现连号发票和异常支出 │ │
│ │ [查看工单详情]                   │ │
│ └─────────────────────────────────┘ │
│ ┌─────────────────────────────────┐ │
│ │ 💡 原始线索                      │ │
│ │ CLUE2025001                     │ │
│ │ 科研经费报销存在连号发票异常     │ │
│ │ 类型: 系统预警                   │ │
│ │ [查看线索详情]                   │ │
│ └─────────────────────────────────┘ │
├─────────────────────────────────────┤
│ 问题描述                              │
│ 整改措施                              │
│ 量化指标                              │
│ 时间轴                                │
│ 佐证材料                              │
└─────────────────────────────────────┘
```

## 📊 数据统计

### 当前系统数据
- **线索总数**: 15条
  - 待处置: 3条
  - 处置中: 9条
  - 已完成: 3条

- **工单总数**: 12条（与线索关联）
  - 待分配: 1条
  - 进行中: 5条
  - 待审核: 1条
  - 已完成: 5条

- **整改总数**: 12条（与工单关联）
  - 待整改: 0条
  - 整改中: 7条
  - 待复查: 3条
  - 已完成: 2条

### 完整闭环数量
- 线索→工单→整改 完整链路: 12条
- 仅线索（未创建工单）: 3条

## 🎨 UI/UX 优化建议

### 1. 状态流转可视化
在详情页面顶部显示流程进度条：
```
[线索发现] → [工单核查] → [整改跟踪] → [复查销号]
   ✅           ✅           进行中         待完成
```

### 2. 快速跳转按钮
在每个详情页面添加"关联信息"快捷区域，方便快速查看上下游信息。

### 3. 时间轴展示
在整改详情页面的时间轴中，包含：
- 线索发现时间
- 工单创建时间
- 工单完成时间
- 整改开始时间
- 整改进度节点

## 🔧 下一步工作

1. ✅ 创建线索库页面和数据
2. ⏳ 更新工单数据，添加线索关联
3. ⏳ 更新整改数据，添加完整追溯链
4. ⏳ 在各详情页面添加关联信息展示
5. ⏳ 实现页面间的跳转逻辑
6. ⏳ 添加"创建工单"和"创建整改"功能
7. ⏳ 完善数据一致性检查

---

**文档版本**: v1.0  
**更新时间**: 2025-10-28  
**状态**: 🚧 开发中
