# 预警详情页面集成完成

## 更新时间
2025-10-28

## 功能说明

现在从"我的待办"点击预警来源后，会直接跳转到alert-center.html页面并自动打开对应的预警详情，展示与预警中心完全一致的内容和布局。

## 实现方式

### 1. URL参数传递
从待办详情点击"来源追溯"的"查看"按钮时，会跳转到：
```
alert-center.html?id=YJ-2025-001
```

### 2. 自动打开详情
alert-center.js的init方法会：
1. 检查URL中是否有id参数
2. 根据id查找对应的预警
3. 自动调用viewAlertDetail方法打开详情模态框

### 3. 预警编号统一
统一使用预警编号（code）作为标识：
- dashboard.js中的source.id：`YJ-2025-001`
- alert-center.js中的code：`YJ-2025-001`

## 更新内容

### 1. alert-center.js
**新增功能**：URL参数处理

```javascript
init() {
    this.renderStatsCards();
    this.renderAlertList();
    this.bindEvents();
    
    // 检查URL参数，如果有id参数则自动打开详情
    const urlParams = new URLSearchParams(window.location.search);
    const alertId = urlParams.get('id');
    if (alertId) {
        const alert = this.mockData.alerts.find(a => a.code === alertId || a.id == alertId);
        if (alert) {
            setTimeout(() => {
                this.viewAlertDetail(alert.id);
            }, 300);
        } else {
            Toast.warning(`未找到预警：${alertId}`);
        }
    }
}
```

### 2. dashboard.js
**更新内容**：统一预警编号

| 待办ID | 待办标题 | 原source.id | 新source.id |
|--------|---------|-------------|-------------|
| 1 | 审核科研经费报销单 | ALERT2025001 | YJ-2025-001 |
| 3 | 处理招生录取异常预警 | ALERT2025003 | YJ-2025-003 |
| 7 | 审核供应商关联冲突预警 | ALERT2025005 | YJ-2025-006 |

### 3. alert-center.js预警数据
**补充内容**：为第6个预警添加完整字段

```javascript
{
    id: 6,
    code: 'YJ-2025-006',  // 新增
    title: '供应商关联冲突预警',
    person: '采购负责人',  // 新增
    amount: '380万元',  // 新增
    project: '实验设备采购项目',  // 新增
    rule: '供应商关联关系检测规则',  // 新增
    threshold: '2家及以上',  // 新增
    ruleDescription: '...',  // 新增
    time: '2025-10-19 15:30:00',  // 新增
    handler: null  // 新增
}
```

## 使用流程

### 用户操作流程
1. 打开dashboard.html（个人工作台）
2. 点击待办列表中的"查看"按钮
3. 在待办详情中找到"来源追溯"部分
4. 点击"查看"按钮
5. 自动跳转到alert-center.html并打开预警详情

### 技术流程
1. 用户点击"查看"按钮
2. 调用`Dashboard.viewSourceDetail('alert', 'YJ-2025-001')`
3. 在新标签页打开`alert-center.html?id=YJ-2025-001`
4. alert-center.js的init方法检测到URL参数
5. 根据code查找预警数据
6. 延迟300ms后调用viewAlertDetail打开详情模态框

## 预警详情内容

### 基本信息
- 预警编号
- 预警类型
- 风险等级
- 预警状态
- 触发时间
- 处理人
- 预警标题

### 预警内容
- 详细描述

### 涉及对象
- 涉及部门
- 涉及人员
- 涉及金额
- 涉及项目

### 规则信息
- 触发规则
- 规则阈值
- 规则说明

### 处理记录
- 时间轴展示
- 操作历史

### 操作按钮
- 关闭
- 标注误报
- 生成线索
- 分发处置

## 预警编号映射表

| 预警编号 | 预警标题 | 风险等级 | 涉及部门 | 涉及金额 |
|---------|---------|---------|---------|---------|
| YJ-2025-001 | 科研经费异常报销 - 连号发票检测 | 高风险 | 计算机学院 | 52,000元 |
| YJ-2025-002 | 三公经费超预算预警 | 高风险 | 行政办公室 | 285,000元 |
| YJ-2025-003 | 招生录取低分高录异常 | 高风险 | 计算机学院 | - |
| YJ-2025-006 | 供应商关联冲突预警 | 高风险 | 采购中心 | 380万元 |

## 测试步骤

### 测试1：科研经费预警
1. 打开dashboard.html
2. 点击"审核科研经费报销单 - 张教授课题组"的"查看"
3. 点击"来源追溯"的"查看"按钮
4. 验证跳转到alert-center.html?id=YJ-2025-001
5. 验证自动打开预警详情模态框
6. 验证详情内容完整显示

### 测试2：招生录取预警
1. 打开dashboard.html
2. 点击"处理招生录取异常预警 - 计算机学院"的"查看"
3. 点击"来源追溯"的"查看"按钮
4. 验证跳转到alert-center.html?id=YJ-2025-003
5. 验证自动打开预警详情模态框

### 测试3：供应商关联预警
1. 打开dashboard.html
2. 点击"审核供应商关联冲突预警"的"查看"
3. 点击"来源追溯"的"查看"按钮
4. 验证跳转到alert-center.html?id=YJ-2025-006
5. 验证自动打开预警详情模态框

### 测试4：直接URL访问
1. 直接在浏览器中访问：`alert-center.html?id=YJ-2025-001`
2. 验证页面加载后自动打开预警详情
3. 验证详情内容正确显示

## 注意事项

1. **浏览器缓存**：更新后必须强制刷新（Ctrl+Shift+R）
2. **预警编号**：确保dashboard和alert-center中的预警编号一致
3. **延迟打开**：使用300ms延迟确保页面完全加载
4. **错误处理**：如果预警不存在，显示提示信息

## 文件更新

- `js/alert-center.js` - 添加URL参数处理（v2.0）
- `js/dashboard.js` - 统一预警编号（v3.2）
- `alert-center.html` - 更新版本号（v2.0）
- `dashboard.html` - 更新版本号（v3.2）

## 后续优化

1. 添加返回按钮，方便用户返回待办列表
2. 支持更多类型的来源跳转（线索、工单、整改）
3. 添加页面跳转的动画效果
4. 优化移动端的显示效果
5. 添加预警详情的打印功能

## 常见问题

**Q: 点击"查看"后没有自动打开详情？**
A: 检查浏览器控制台是否有错误，确保已强制刷新。

**Q: 提示"未找到预警"？**
A: 检查预警编号是否正确，确保dashboard和alert-center中的编号一致。

**Q: 详情内容不完整？**
A: 检查alert-center.js中的预警数据是否包含所有必要字段。

**Q: 如何关闭详情模态框？**
A: 点击右上角的关闭按钮或点击模态框外部区域。

## 更新记录

- 2025-10-28 16:00 - 实现URL参数处理和自动打开详情
- 2025-10-28 16:00 - 统一预警编号格式
- 2025-10-28 16:00 - 补充预警数据字段
