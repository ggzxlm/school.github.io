<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å½’æ¡£é¡µé¢è¯Šæ–­</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #1f2937;
            color: #f3f4f6;
        }
        .log {
            background: #111827;
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 16px;
            border-left: 4px solid #3b82f6;
        }
        .success { border-left-color: #10b981; }
        .error { border-left-color: #ef4444; }
        .warning { border-left-color: #f59e0b; }
        h1 { color: #60a5fa; }
        h2 { color: #34d399; margin-top: 24px; }
        button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin-right: 10px;
        }
        button:hover { background: #2563eb; }
        .btn-test { background: #10b981; }
        .btn-test:hover { background: #059669; }
    </style>
</head>
<body>
    <h1>ğŸ” å½’æ¡£é¡µé¢è¯Šæ–­å·¥å…·</h1>
    
    <div>
        <button onclick="testComponents()">æµ‹è¯•ç»„ä»¶åŠ è½½</button>
        <button onclick="testArchivePage()" class="btn-test">æµ‹è¯•å½’æ¡£é¡µé¢</button>
        <button onclick="clearLogs()">æ¸…é™¤æ—¥å¿—</button>
    </div>

    <h2>ğŸ“‹ è¯Šæ–­æ—¥å¿—</h2>
    <div id="logs"></div>

    <script>
        function log(message, type = 'info') {
            const logs = document.getElementById('logs');
            const logDiv = document.createElement('div');
            logDiv.className = `log ${type}`;
            logDiv.innerHTML = `
                <strong>[${new Date().toLocaleTimeString()}]</strong> ${message}
            `;
            logs.insertBefore(logDiv, logs.firstChild);
        }

        function clearLogs() {
            document.getElementById('logs').innerHTML = '';
            log('æ—¥å¿—å·²æ¸…é™¤', 'info');
        }

        function testComponents() {
            log('å¼€å§‹æµ‹è¯•ç»„ä»¶...', 'info');
            
            // æµ‹è¯• common.js
            const commonScript = document.createElement('script');
            commonScript.src = 'js/common.js?v=3';
            commonScript.onload = () => {
                log('âœ“ common.js åŠ è½½æˆåŠŸ', 'success');
                
                // æµ‹è¯• components.js
                const componentsScript = document.createElement('script');
                componentsScript.src = 'js/components.js?v=3';
                componentsScript.onload = () => {
                    log('âœ“ components.js åŠ è½½æˆåŠŸ', 'success');
                    
                    // æ£€æŸ¥ç»„ä»¶æ˜¯å¦å­˜åœ¨
                    if (typeof TopNavbar !== 'undefined') {
                        log('âœ“ TopNavbar ç»„ä»¶å­˜åœ¨', 'success');
                    } else {
                        log('âœ— TopNavbar ç»„ä»¶ä¸å­˜åœ¨', 'error');
                    }
                    
                    if (typeof SideNavbar !== 'undefined') {
                        log('âœ“ SideNavbar ç»„ä»¶å­˜åœ¨', 'success');
                    } else {
                        log('âœ— SideNavbar ç»„ä»¶ä¸å­˜åœ¨', 'error');
                    }
                    
                    if (typeof Footer !== 'undefined') {
                        log('âœ“ Footer ç»„ä»¶å­˜åœ¨', 'success');
                    } else {
                        log('âœ— Footer ç»„ä»¶ä¸å­˜åœ¨', 'error');
                    }
                };
                componentsScript.onerror = () => {
                    log('âœ— components.js åŠ è½½å¤±è´¥', 'error');
                };
                document.head.appendChild(componentsScript);
            };
            commonScript.onerror = () => {
                log('âœ— common.js åŠ è½½å¤±è´¥', 'error');
            };
            document.head.appendChild(commonScript);
        }

        function testArchivePage() {
            log('å¼€å§‹æµ‹è¯•å½’æ¡£é¡µé¢...', 'info');
            
            // æµ‹è¯•å½’æ¡£è„šæœ¬
            const archiveScript = document.createElement('script');
            archiveScript.src = 'js/rectification-archive.js?v=1';
            archiveScript.onload = () => {
                log('âœ“ rectification-archive.js åŠ è½½æˆåŠŸ', 'success');
                
                // æ£€æŸ¥å…³é”®å‡½æ•°æ˜¯å¦å­˜åœ¨
                const functions = [
                    'loadArchivedData',
                    'initializePage',
                    'updateDashboard',
                    'renderTable',
                    'bindEvents',
                    'viewArchiveDetail'
                ];
                
                functions.forEach(funcName => {
                    if (typeof window[funcName] === 'function') {
                        log(`âœ“ å‡½æ•° ${funcName} å­˜åœ¨`, 'success');
                    } else {
                        log(`âœ— å‡½æ•° ${funcName} ä¸å­˜åœ¨`, 'error');
                    }
                });
                
                // å°è¯•è°ƒç”¨åˆå§‹åŒ–
                try {
                    if (typeof loadArchivedData === 'function') {
                        loadArchivedData();
                        log('âœ“ loadArchivedData() æ‰§è¡ŒæˆåŠŸ', 'success');
                    }
                } catch (error) {
                    log(`âœ— loadArchivedData() æ‰§è¡Œå¤±è´¥: ${error.message}`, 'error');
                }
            };
            archiveScript.onerror = () => {
                log('âœ— rectification-archive.js åŠ è½½å¤±è´¥', 'error');
            };
            document.head.appendChild(archiveScript);
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡ŒåŸºç¡€æµ‹è¯•
        window.addEventListener('load', () => {
            log('è¯Šæ–­å·¥å…·å·²å°±ç»ª', 'success');
            log('ç‚¹å‡»æŒ‰é’®å¼€å§‹æµ‹è¯•', 'info');
        });

        // æ•è·å…¨å±€é”™è¯¯
        window.addEventListener('error', (event) => {
            log(`å…¨å±€é”™è¯¯: ${event.message} (${event.filename}:${event.lineno})`, 'error');
        });

        // æ•è·æœªå¤„ç†çš„Promiseé”™è¯¯
        window.addEventListener('unhandledrejection', (event) => {
            log(`æœªå¤„ç†çš„Promiseé”™è¯¯: ${event.reason}`, 'error');
        });
    </script>
</body>
</html>
