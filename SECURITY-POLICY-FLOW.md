# 安全策略执行流程图解

## 简化流程

```
┌─────────────────────────────────────────────────────────────┐
│                     用户操作数据                              │
│              (查询/修改/导出/删除)                            │
└────────────────────┬────────────────────────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────────────────────────┐
│  第1步：识别数据类型                                          │
│  ┌──────────────────────────────────────────────────────┐   │
│  │ 查询数据分类表 (data-classification)                  │   │
│  │ • 表名: financial_transaction                        │   │
│  │ • 分类: 财务数据                                      │   │
│  │ • 级别: L4-机密  ← 这就是"核心数据"的标识            │   │
│  │ • 字段: amount, account                              │   │
│  └──────────────────────────────────────────────────────┘   │
└────────────────────┬────────────────────────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────────────────────────┐
│  第2步：匹配安全策略                                          │
│  ┌──────────────────────────────────────────────────────┐   │
│  │ 根据数据级别查找策略 (data-security-management)       │   │
│  │                                                       │   │
│  │ L4级别 → 应用以下策略:                                │   │
│  │ ✓ 数据加密策略 (高级别)                               │   │
│  │ ✓ 访问控制策略 (高级别)                               │   │
│  │ ✓ 审计监控策略 (高级别)                               │   │
│  │ ✓ 数据备份策略 (高级别)                               │   │
│  └──────────────────────────────────────────────────────┘   │
└────────────────────┬────────────────────────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────────────────────────┐
│  第3步：执行策略检查                                          │
│  ┌──────────────────────────────────────────────────────┐   │
│  │ 访问控制策略:                                         │   │
│  │ • 验证用户身份 ✓                                      │   │
│  │ • 检查访问权限 ✓                                      │   │
│  │ • 需要审批? (L4需要) → 等待审批                       │   │
│  │                                                       │   │
│  │ 数据加密策略:                                         │   │
│  │ • 标记需加密字段                                      │   │
│  │ • 准备加密算法 (AES-256)                              │   │
│  │                                                       │   │
│  │ 审计监控策略:                                         │   │
│  │ • 准备日志记录                                        │   │
│  │ • 记录操作详情                                        │   │
│  └──────────────────────────────────────────────────────┘   │
└────────────────────┬────────────────────────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────────────────────────┐
│  第4步：执行操作                                              │
│  ┌──────────────────────────────────────────────────────┐   │
│  │ 权限检查通过 → 执行数据操作                           │   │
│  │ 权限检查失败 → 拒绝访问，返回错误                     │   │
│  └──────────────────────────────────────────────────────┘   │
└────────────────────┬────────────────────────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────────────────────────┐
│  第5步：后处理                                                │
│  ┌──────────────────────────────────────────────────────┐   │
│  │ • 数据脱敏: 110101199001011234 → 110101********1234  │   │
│  │ • 数据加密: 敏感字段加密存储                          │   │
│  │ • 记录日志: 保存到审计日志表                          │   │
│  │ • 异常告警: 发现异常行为时触发告警                    │   │
│  └──────────────────────────────────────────────────────┘   │
└────────────────────┬────────────────────────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────────────────────────┐
│                   返回结果给用户                              │
└─────────────────────────────────────────────────────────────┘
```

## 核心数据识别方法

### 方法1: 数据级别标识 ⭐ 推荐

```
数据分类系统中设置:
┌──────────────────────────────┐
│ 表名: financial_transaction  │
│ 级别: L4-机密  ← 核心数据标识 │
└──────────────────────────────┘

系统自动识别:
if (dataLevel === "L4") {
  // 这是核心数据！
  // 应用最严格的安全策略
}
```

### 方法2: 数据分类标识

```
数据分类系统中设置:
┌──────────────────────────────┐
│ 表名: salary_info            │
│ 分类: 财务数据  ← 核心数据类型│
└──────────────────────────────┘

系统自动识别:
if (dataCategory === "财务数据") {
  // 这是核心数据！
  // 应用财务数据专用策略
}
```

### 方法3: 敏感字段标识

```
数据分类系统中设置:
┌──────────────────────────────┐
│ 表名: employee_info          │
│ 敏感字段: [                  │
│   "id_card",  ← 核心字段     │
│   "salary",   ← 核心字段     │
│   "bank_card" ← 核心字段     │
│ ]                            │
└──────────────────────────────┘

系统自动识别:
if (sensitiveFields.includes(fieldName)) {
  // 这是核心字段！
  // 应用脱敏策略
}
```

## 实际案例

### 案例1: 查询学生信息

```
用户操作:
  SELECT * FROM student_info WHERE id = 123

↓ 系统识别
  表名: student_info
  分类: 个人信息
  级别: L3-敏感  ← 识别为敏感数据
  字段: [name, id_card, phone]

↓ 匹配策略
  ✓ 访问控制策略 (L3级别)
  ✓ 数据脱敏策略 (L3级别)
  ✓ 审计监控策略 (L3级别)

↓ 执行检查
  ✓ 用户有访问权限
  ✓ 需要脱敏: id_card, phone

↓ 返回结果
  {
    name: "张三",
    id_card: "110101********1234",  ← 已脱敏
    phone: "138****5678"             ← 已脱敏
  }

↓ 记录日志
  [2024-10-25 10:30:00] 用户张三查询student_info，成功
```

### 案例2: 导出财务数据

```
用户操作:
  导出 financial_transaction 表

↓ 系统识别
  表名: financial_transaction
  分类: 财务数据
  级别: L4-机密  ← 识别为核心数据！
  字段: [amount, account]

↓ 匹配策略
  ✓ 访问控制策略 (L4级别 - 需要审批)
  ✓ 数据加密策略 (L4级别 - 强制加密)
  ✓ 审计监控策略 (L4级别 - 完整审计)

↓ 执行检查
  ✗ 需要二级审批
  → 发送审批申请
  → 等待部门主管审批
  → 等待安全管理员审批

↓ 审批通过后
  ✓ 导出数据
  ✓ 使用AES-256加密
  ✓ 记录详细日志

↓ 返回结果
  encrypted_file.zip (加密文件)

↓ 记录日志
  [2024-10-25 10:35:00] 用户李四申请导出financial_transaction
  [2024-10-25 10:40:00] 部门主管审批通过
  [2024-10-25 10:45:00] 安全管理员审批通过
  [2024-10-25 10:46:00] 导出成功，文件已加密
```

## 配置关联图

```
┌─────────────────────────────────────────────────────────┐
│           数据分级分类系统                                │
│        (data-classification.html)                       │
│                                                         │
│  定义哪些是核心数据:                                     │
│  • 财务数据 → L4-机密                                   │
│  • 个人信息 → L3-敏感                                   │
│  • 业务数据 → L2-内部                                   │
│  • 公开数据 → L1-公开                                   │
└────────────────┬────────────────────────────────────────┘
                 │
                 │ 关联
                 │
                 ▼
┌─────────────────────────────────────────────────────────┐
│           数据安全管理系统                                │
│      (data-security-management.html)                    │
│                                                         │
│  定义如何保护数据:                                       │
│  • 数据加密策略 → 适用范围: L4级别数据                   │
│  • 访问控制策略 → 适用范围: L3/L4级别数据                │
│  • 数据脱敏策略 → 适用范围: 包含敏感字段的数据           │
│  • 审计监控策略 → 适用范围: 所有数据                     │
└────────────────┬────────────────────────────────────────┘
                 │
                 │ 执行
                 │
                 ▼
┌─────────────────────────────────────────────────────────┐
│              策略引擎 (自动执行)                          │
│                                                         │
│  在数据操作时自动:                                       │
│  1. 识别数据类型和级别                                   │
│  2. 匹配适用的安全策略                                   │
│  3. 执行策略规则                                         │
│  4. 记录审计日志                                         │
└─────────────────────────────────────────────────────────┘
```

## 关键点总结

### 1. 核心数据的识别 🎯

**通过数据级别**:
- L4-机密 = 核心数据（财务、薪资）
- L3-敏感 = 重要数据（个人信息）
- L2-内部 = 一般数据（业务数据）
- L1-公开 = 普通数据（公告新闻）

### 2. 策略的触发时机 ⏰

- 数据访问时 → 访问控制
- 数据展示时 → 数据脱敏
- 数据导出时 → 审批+加密
- 数据修改时 → 变更审计
- 定时任务时 → 数据备份

### 3. 策略的应用方式 🔧

**自动应用**:
系统根据数据级别自动匹配和执行策略

**无需手动**:
不需要在每次操作时手动选择策略

**智能识别**:
通过数据分类系统自动识别核心数据

---

**简单来说**:
1. 在数据分类系统中标记哪些是核心数据（设置为L4级别）
2. 在安全管理系统中创建策略（设置适用范围为L4）
3. 系统自动在访问L4数据时应用这些策略
4. 无需手动干预，全自动执行！

**版本**: 1.0.0  
**更新时间**: 2024-10-25
